//
// Generated by Bluespec Compiler, version 2025.01.1-9-g76db531e (build 76db531e)
//
// On Sun Nov  2 15:21:57 UTC 2025
//
//
// Ports:
// Name                         I/O  size props
// RDY_load_weight                O     1 const
// RDY_compute                    O     1 const
// get_activation_out             O    16 reg
// RDY_get_activation_out         O     1 const
// get_psum_out                   O    16 reg
// RDY_get_psum_out               O     1 const
// CLK                            I     1 clock
// RST_N                          I     1 reset
// load_weight_w                  I    16 reg
// compute_act_in                 I    16
// compute_psum_in                I    16
// EN_load_weight                 I     1
// EN_compute                     I     1
//
// No combinational paths from inputs to outputs
//
//

`ifdef BSV_ASSIGNMENT_DELAY
`else
  `define BSV_ASSIGNMENT_DELAY
`endif

`ifdef BSV_POSITIVE_RESET
  `define BSV_RESET_VALUE 1'b1
  `define BSV_RESET_EDGE posedge
`else
  `define BSV_RESET_VALUE 1'b0
  `define BSV_RESET_EDGE negedge
`endif

module mkBF16_PE(CLK,
		 RST_N,

		 load_weight_w,
		 EN_load_weight,
		 RDY_load_weight,

		 compute_act_in,
		 compute_psum_in,
		 EN_compute,
		 RDY_compute,

		 get_activation_out,
		 RDY_get_activation_out,

		 get_psum_out,
		 RDY_get_psum_out);
  input  CLK;
  input  RST_N;

  // action method load_weight
  input  [15 : 0] load_weight_w;
  input  EN_load_weight;
  output RDY_load_weight;

  // action method compute
  input  [15 : 0] compute_act_in;
  input  [15 : 0] compute_psum_in;
  input  EN_compute;
  output RDY_compute;

  // value method get_activation_out
  output [15 : 0] get_activation_out;
  output RDY_get_activation_out;

  // value method get_psum_out
  output [15 : 0] get_psum_out;
  output RDY_get_psum_out;

  // signals for module outputs
  wire [15 : 0] get_activation_out, get_psum_out;
  wire RDY_compute, RDY_get_activation_out, RDY_get_psum_out, RDY_load_weight;

  // register activation_out_reg
  reg [15 : 0] activation_out_reg;
  wire [15 : 0] activation_out_reg$D_IN;
  wire activation_out_reg$EN;

  // register psum_out_reg
  reg [15 : 0] psum_out_reg;
  wire [15 : 0] psum_out_reg$D_IN;
  wire psum_out_reg$EN;

  // register weight_reg
  reg [15 : 0] weight_reg;
  wire [15 : 0] weight_reg$D_IN;
  wire weight_reg$EN;

  // remaining internal signals
  wire [31 : 0] _1_CONCAT_weight_reg_BITS_6_TO_0_5_6_MUL_1_CONC_ETC___d19;
  wire [15 : 0] IF_compute_psum_in_EQ_0x0_6_THEN_weight_reg_BI_ETC___d93,
		product__h376,
		result__h942;
  wire [14 : 0] IF_IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_co_ETC___d86,
		IF_IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_co_ETC___d87,
		IF_IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_co_ETC___d88,
		IF_IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_co_ETC___d90;
  wire [8 : 0] _1_CONCAT_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_ETC___d46,
	       _theResult____h758,
	       exp_sum__h464,
	       man_result__h853,
	       man_result__h928,
	       raw_exp__h465,
	       x__h684;
  wire [7 : 0] _theResult___fst__h678,
	       a_exp__h760,
	       exp_diff__h753,
	       final_exp___1__h973,
	       final_exp__h1031,
	       final_exp__h1060,
	       final_exp__h1089,
	       final_exp__h1091,
	       final_exp__h602,
	       larger_exp__h807,
	       result_exp__h539,
	       shift_amount__h754,
	       shifted_smaller__h755,
	       smaller_exp__h848,
	       smaller_man__h752;
  wire [6 : 0] _theResult___snd__h679,
	       a_mantissa__h761,
	       final_mantissa__h1032,
	       final_mantissa__h1061,
	       final_mantissa__h1090,
	       final_mantissa__h1092;
  wire IF_weight_reg_BITS_14_TO_7_EQ_0_OR_compute_act_ETC___d39,
       _0_CONCAT_weight_reg_BITS_14_TO_7_0_PLUS_0_CONC_ETC___d14,
       a_sign__h759,
       larger_sign__h806,
       smaller_sign__h847;

  // action method load_weight
  assign RDY_load_weight = 1'd1 ;

  // action method compute
  assign RDY_compute = 1'd1 ;

  // value method get_activation_out
  assign get_activation_out = activation_out_reg ;
  assign RDY_get_activation_out = 1'd1 ;

  // value method get_psum_out
  assign get_psum_out = psum_out_reg ;
  assign RDY_get_psum_out = 1'd1 ;

  // register activation_out_reg
  assign activation_out_reg$D_IN = compute_act_in ;
  assign activation_out_reg$EN = EN_compute ;

  // register psum_out_reg
  assign psum_out_reg$D_IN =
	     (product__h376 == 16'h0 && compute_psum_in == 16'h0) ?
	       16'h0 :
	       ((product__h376 == 16'h0) ?
		  compute_psum_in :
		  IF_compute_psum_in_EQ_0x0_6_THEN_weight_reg_BI_ETC___d93) ;
  assign psum_out_reg$EN = EN_compute ;

  // register weight_reg
  assign weight_reg$D_IN = load_weight_w ;
  assign weight_reg$EN = EN_load_weight ;

  // remaining internal signals
  assign IF_IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_co_ETC___d86 =
	     _theResult____h758[4] ?
	       { final_exp__h1089, final_mantissa__h1090 } :
	       { final_exp__h1091, final_mantissa__h1092 } ;
  assign IF_IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_co_ETC___d87 =
	     _theResult____h758[5] ?
	       { final_exp__h1060, final_mantissa__h1061 } :
	       IF_IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_co_ETC___d86 ;
  assign IF_IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_co_ETC___d88 =
	     _theResult____h758[6] ?
	       { final_exp__h1031, final_mantissa__h1032 } :
	       IF_IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_co_ETC___d87 ;
  assign IF_IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_co_ETC___d90 =
	     _theResult____h758[8] ?
	       { final_exp___1__h973, _theResult____h758[7:1] } :
	       (_theResult____h758[7] ?
		  { larger_exp__h807, _theResult____h758[6:0] } :
		  IF_IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_co_ETC___d88) ;
  assign IF_compute_psum_in_EQ_0x0_6_THEN_weight_reg_BI_ETC___d93 =
	     (compute_psum_in == 16'h0) ?
	       product__h376 :
	       ((_theResult____h758 == 9'd0) ? 16'h0 : result__h942) ;
  assign IF_weight_reg_BITS_14_TO_7_EQ_0_OR_compute_act_ETC___d39 =
	     a_exp__h760 < compute_psum_in[14:7] ;
  assign _0_CONCAT_weight_reg_BITS_14_TO_7_0_PLUS_0_CONC_ETC___d14 =
	     raw_exp__h465 <= 9'd255 ;
  assign _1_CONCAT_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_ETC___d46 =
	     { 2'd1,
	       IF_weight_reg_BITS_14_TO_7_EQ_0_OR_compute_act_ETC___d39 ?
		 compute_psum_in[6:0] :
		 a_mantissa__h761 } ;
  assign _1_CONCAT_weight_reg_BITS_6_TO_0_5_6_MUL_1_CONC_ETC___d19 =
	     { 9'd1, weight_reg[6:0] } * { 9'd1, compute_act_in[6:0] } ;
  assign _theResult____h758 =
	     (larger_sign__h806 == smaller_sign__h847) ?
	       man_result__h928 :
	       man_result__h853 ;
  assign _theResult___fst__h678 =
	     _1_CONCAT_weight_reg_BITS_6_TO_0_5_6_MUL_1_CONC_ETC___d19[15] ?
	       x__h684[7:0] :
	       raw_exp__h465[7:0] ;
  assign _theResult___snd__h679 =
	     _1_CONCAT_weight_reg_BITS_6_TO_0_5_6_MUL_1_CONC_ETC___d19[15] ?
	       _1_CONCAT_weight_reg_BITS_6_TO_0_5_6_MUL_1_CONC_ETC___d19[14:8] :
	       _1_CONCAT_weight_reg_BITS_6_TO_0_5_6_MUL_1_CONC_ETC___d19[13:7] ;
  assign a_exp__h760 =
	     (weight_reg[14:7] == 8'd0 || compute_act_in[14:7] == 8'd0) ?
	       8'b0 :
	       result_exp__h539 ;
  assign a_mantissa__h761 =
	     (weight_reg[14:7] == 8'd0 || compute_act_in[14:7] == 8'd0 ||
	      !_0_CONCAT_weight_reg_BITS_14_TO_7_0_PLUS_0_CONC_ETC___d14) ?
	       7'b0 :
	       _theResult___snd__h679 ;
  assign a_sign__h759 = weight_reg[15] ^ compute_act_in[15] ;
  assign exp_diff__h753 = larger_exp__h807 - smaller_exp__h848 ;
  assign exp_sum__h464 =
	     { 1'd0, weight_reg[14:7] } + { 1'd0, compute_act_in[14:7] } ;
  assign final_exp___1__h973 = larger_exp__h807 + 8'd1 ;
  assign final_exp__h1031 = larger_exp__h807 - 8'd1 ;
  assign final_exp__h1060 = larger_exp__h807 - 8'd2 ;
  assign final_exp__h1089 = larger_exp__h807 - 8'd3 ;
  assign final_exp__h1091 = larger_exp__h807 - 8'd4 ;
  assign final_exp__h602 =
	     _0_CONCAT_weight_reg_BITS_14_TO_7_0_PLUS_0_CONC_ETC___d14 ?
	       8'b0 :
	       8'hFF ;
  assign final_mantissa__h1032 = { _theResult____h758[5:0], 1'b0 } ;
  assign final_mantissa__h1061 = { _theResult____h758[4:0], 2'b0 } ;
  assign final_mantissa__h1090 = { _theResult____h758[3:0], 3'b0 } ;
  assign final_mantissa__h1092 = { _theResult____h758[2:0], 4'b0 } ;
  assign larger_exp__h807 =
	     IF_weight_reg_BITS_14_TO_7_EQ_0_OR_compute_act_ETC___d39 ?
	       compute_psum_in[14:7] :
	       a_exp__h760 ;
  assign larger_sign__h806 =
	     IF_weight_reg_BITS_14_TO_7_EQ_0_OR_compute_act_ETC___d39 ?
	       compute_psum_in[15] :
	       a_sign__h759 ;
  assign man_result__h853 =
	     _1_CONCAT_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_ETC___d46 -
	     { 1'd0, shifted_smaller__h755 } ;
  assign man_result__h928 =
	     _1_CONCAT_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_ETC___d46 +
	     { 1'd0, shifted_smaller__h755 } ;
  assign product__h376 = { a_sign__h759, a_exp__h760, a_mantissa__h761 } ;
  assign raw_exp__h465 = exp_sum__h464 - 9'd127 ;
  assign result__h942 =
	     { larger_sign__h806,
	       IF_IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_co_ETC___d90 } ;
  assign result_exp__h539 =
	     _0_CONCAT_weight_reg_BITS_14_TO_7_0_PLUS_0_CONC_ETC___d14 ?
	       _theResult___fst__h678 :
	       final_exp__h602 ;
  assign shift_amount__h754 =
	     (exp_diff__h753 <= 8'd8) ? exp_diff__h753 : 8'd8 ;
  assign shifted_smaller__h755 = smaller_man__h752 >> shift_amount__h754 ;
  assign smaller_exp__h848 =
	     IF_weight_reg_BITS_14_TO_7_EQ_0_OR_compute_act_ETC___d39 ?
	       a_exp__h760 :
	       compute_psum_in[14:7] ;
  assign smaller_man__h752 =
	     { 1'b1,
	       IF_weight_reg_BITS_14_TO_7_EQ_0_OR_compute_act_ETC___d39 ?
		 a_mantissa__h761 :
		 compute_psum_in[6:0] } ;
  assign smaller_sign__h847 =
	     IF_weight_reg_BITS_14_TO_7_EQ_0_OR_compute_act_ETC___d39 ?
	       a_sign__h759 :
	       compute_psum_in[15] ;
  assign x__h684 = raw_exp__h465 + 9'd1 ;

  // handling of inlined registers

  always@(posedge CLK)
  begin
    if (RST_N == `BSV_RESET_VALUE)
      begin
        activation_out_reg <= `BSV_ASSIGNMENT_DELAY 16'd0;
	psum_out_reg <= `BSV_ASSIGNMENT_DELAY 16'd0;
	weight_reg <= `BSV_ASSIGNMENT_DELAY 16'd0;
      end
    else
      begin
        if (activation_out_reg$EN)
	  activation_out_reg <= `BSV_ASSIGNMENT_DELAY activation_out_reg$D_IN;
	if (psum_out_reg$EN)
	  psum_out_reg <= `BSV_ASSIGNMENT_DELAY psum_out_reg$D_IN;
	if (weight_reg$EN)
	  weight_reg <= `BSV_ASSIGNMENT_DELAY weight_reg$D_IN;
      end
  end

  // synopsys translate_off
  `ifdef BSV_NO_INITIAL_BLOCKS
  `else // not BSV_NO_INITIAL_BLOCKS
  initial
  begin
    activation_out_reg = 16'hAAAA;
    psum_out_reg = 16'hAAAA;
    weight_reg = 16'hAAAA;
  end
  `endif // BSV_NO_INITIAL_BLOCKS
  // synopsys translate_on
endmodule  // mkBF16_PE

