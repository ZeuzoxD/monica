//
// Generated by Bluespec Compiler, version 2025.01.1-9-g76db531e (build 76db531e)
//
// On Mon Oct 27 10:28:02 UTC 2025
//
//
// Ports:
// Name                         I/O  size props
// RDY_load_weight                O     1 const
// RDY_compute                    O     1 const
// get_activation_out             O    16 reg
// RDY_get_activation_out         O     1 const
// get_psum_out                   O    16 reg
// RDY_get_psum_out               O     1 const
// CLK                            I     1 clock
// RST_N                          I     1 reset
// load_weight_w                  I    16 reg
// compute_act_in                 I    16
// compute_psum_in                I    16
// EN_load_weight                 I     1
// EN_compute                     I     1
//
// No combinational paths from inputs to outputs
//
//

`ifdef BSV_ASSIGNMENT_DELAY
`else
  `define BSV_ASSIGNMENT_DELAY
`endif

`ifdef BSV_POSITIVE_RESET
  `define BSV_RESET_VALUE 1'b1
  `define BSV_RESET_EDGE posedge
`else
  `define BSV_RESET_VALUE 1'b0
  `define BSV_RESET_EDGE negedge
`endif

module mkBF16_PE(CLK,
		 RST_N,

		 load_weight_w,
		 EN_load_weight,
		 RDY_load_weight,

		 compute_act_in,
		 compute_psum_in,
		 EN_compute,
		 RDY_compute,

		 get_activation_out,
		 RDY_get_activation_out,

		 get_psum_out,
		 RDY_get_psum_out);
  input  CLK;
  input  RST_N;

  // action method load_weight
  input  [15 : 0] load_weight_w;
  input  EN_load_weight;
  output RDY_load_weight;

  // action method compute
  input  [15 : 0] compute_act_in;
  input  [15 : 0] compute_psum_in;
  input  EN_compute;
  output RDY_compute;

  // value method get_activation_out
  output [15 : 0] get_activation_out;
  output RDY_get_activation_out;

  // value method get_psum_out
  output [15 : 0] get_psum_out;
  output RDY_get_psum_out;

  // signals for module outputs
  wire [15 : 0] get_activation_out, get_psum_out;
  wire RDY_compute, RDY_get_activation_out, RDY_get_psum_out, RDY_load_weight;

  // register activation_out_reg
  reg [15 : 0] activation_out_reg;
  wire [15 : 0] activation_out_reg$D_IN;
  wire activation_out_reg$EN;

  // register psum_out_reg
  reg [15 : 0] psum_out_reg;
  wire [15 : 0] psum_out_reg$D_IN;
  wire psum_out_reg$EN;

  // register weight_reg
  reg [15 : 0] weight_reg;
  wire [15 : 0] weight_reg$D_IN;
  wire weight_reg$EN;

  // remaining internal signals
  wire [31 : 0] _1_CONCAT_weight_reg_BITS_6_TO_0_2_3_MUL_1_CONC_ETC___d16;
  wire [14 : 0] IF_IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_co_ETC___d81,
		IF_IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_co_ETC___d82,
		IF_IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_co_ETC___d83,
		IF_IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_co_ETC___d85;
  wire [8 : 0] IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_compu_ETC___d54,
	       _1_CONCAT_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_ETC___d42,
	       exp_sum__h505,
	       man_result__h871,
	       man_result__h946,
	       raw_exp__h506,
	       x__h725;
  wire [7 : 0] _theResult___fst__h719,
	       a_exp__h473,
	       exp_diff__h459,
	       final_exp___1__h963,
	       final_exp__h1021,
	       final_exp__h1050,
	       final_exp__h1079,
	       final_exp__h1081,
	       final_exp__h643,
	       larger_exp__h806,
	       result_exp__h580,
	       shift_amount__h460,
	       shifted_smaller__h461,
	       smaller_exp__h866,
	       smaller_man__h458;
  wire [6 : 0] _theResult___snd__h720,
	       a_mantissa__h474,
	       final_mantissa__h1022,
	       final_mantissa__h1051,
	       final_mantissa__h1080,
	       final_mantissa__h1082;
  wire IF_weight_reg_BITS_14_TO_7_EQ_0_OR_compute_act_ETC___d26,
       _0_CONCAT_weight_reg_BITS_14_TO_7_PLUS_0_CONCAT_ETC___d11,
       a_sign__h472,
       larger_sign__h805,
       smaller_sign__h865;

  // action method load_weight
  assign RDY_load_weight = 1'd1 ;

  // action method compute
  assign RDY_compute = 1'd1 ;

  // value method get_activation_out
  assign get_activation_out = activation_out_reg ;
  assign RDY_get_activation_out = 1'd1 ;

  // value method get_psum_out
  assign get_psum_out = psum_out_reg ;
  assign RDY_get_psum_out = 1'd1 ;

  // register activation_out_reg
  assign activation_out_reg$D_IN = compute_act_in ;
  assign activation_out_reg$EN = EN_compute ;

  // register psum_out_reg
  assign psum_out_reg$D_IN =
	     { larger_sign__h805,
	       IF_IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_co_ETC___d85 } ;
  assign psum_out_reg$EN = EN_compute ;

  // register weight_reg
  assign weight_reg$D_IN = load_weight_w ;
  assign weight_reg$EN = EN_load_weight ;

  // remaining internal signals
  assign IF_IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_co_ETC___d81 =
	     IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_compu_ETC___d54[4] ?
	       { final_exp__h1079, final_mantissa__h1080 } :
	       { final_exp__h1081, final_mantissa__h1082 } ;
  assign IF_IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_co_ETC___d82 =
	     IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_compu_ETC___d54[5] ?
	       { final_exp__h1050, final_mantissa__h1051 } :
	       IF_IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_co_ETC___d81 ;
  assign IF_IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_co_ETC___d83 =
	     IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_compu_ETC___d54[6] ?
	       { final_exp__h1021, final_mantissa__h1022 } :
	       IF_IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_co_ETC___d82 ;
  assign IF_IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_co_ETC___d85 =
	     IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_compu_ETC___d54[8] ?
	       { final_exp___1__h963,
		 IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_compu_ETC___d54[7:1] } :
	       (IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_compu_ETC___d54[7] ?
		  { larger_exp__h806,
		    IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_compu_ETC___d54[6:0] } :
		  IF_IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_co_ETC___d83) ;
  assign IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_compu_ETC___d54 =
	     (larger_sign__h805 == smaller_sign__h865) ?
	       man_result__h946 :
	       man_result__h871 ;
  assign IF_weight_reg_BITS_14_TO_7_EQ_0_OR_compute_act_ETC___d26 =
	     a_exp__h473 < compute_psum_in[14:7] ;
  assign _0_CONCAT_weight_reg_BITS_14_TO_7_PLUS_0_CONCAT_ETC___d11 =
	     raw_exp__h506 <= 9'd255 ;
  assign _1_CONCAT_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_ETC___d42 =
	     { 2'd1,
	       IF_weight_reg_BITS_14_TO_7_EQ_0_OR_compute_act_ETC___d26 ?
		 compute_psum_in[6:0] :
		 a_mantissa__h474 } ;
  assign _1_CONCAT_weight_reg_BITS_6_TO_0_2_3_MUL_1_CONC_ETC___d16 =
	     { 9'd1, weight_reg[6:0] } * { 9'd1, compute_act_in[6:0] } ;
  assign _theResult___fst__h719 =
	     _1_CONCAT_weight_reg_BITS_6_TO_0_2_3_MUL_1_CONC_ETC___d16[15] ?
	       x__h725[7:0] :
	       raw_exp__h506[7:0] ;
  assign _theResult___snd__h720 =
	     _1_CONCAT_weight_reg_BITS_6_TO_0_2_3_MUL_1_CONC_ETC___d16[15] ?
	       _1_CONCAT_weight_reg_BITS_6_TO_0_2_3_MUL_1_CONC_ETC___d16[14:8] :
	       _1_CONCAT_weight_reg_BITS_6_TO_0_2_3_MUL_1_CONC_ETC___d16[13:7] ;
  assign a_exp__h473 =
	     (weight_reg[14:7] == 8'd0 || compute_act_in[14:7] == 8'd0) ?
	       8'b0 :
	       result_exp__h580 ;
  assign a_mantissa__h474 =
	     (weight_reg[14:7] == 8'd0 || compute_act_in[14:7] == 8'd0 ||
	      !_0_CONCAT_weight_reg_BITS_14_TO_7_PLUS_0_CONCAT_ETC___d11) ?
	       7'b0 :
	       _theResult___snd__h720 ;
  assign a_sign__h472 = weight_reg[15] ^ compute_act_in[15] ;
  assign exp_diff__h459 = larger_exp__h806 - smaller_exp__h866 ;
  assign exp_sum__h505 =
	     { 1'd0, weight_reg[14:7] } + { 1'd0, compute_act_in[14:7] } ;
  assign final_exp___1__h963 = larger_exp__h806 + 8'd1 ;
  assign final_exp__h1021 = larger_exp__h806 - 8'd1 ;
  assign final_exp__h1050 = larger_exp__h806 - 8'd2 ;
  assign final_exp__h1079 = larger_exp__h806 - 8'd3 ;
  assign final_exp__h1081 = larger_exp__h806 - 8'd4 ;
  assign final_exp__h643 =
	     _0_CONCAT_weight_reg_BITS_14_TO_7_PLUS_0_CONCAT_ETC___d11 ?
	       8'b0 :
	       8'hFF ;
  assign final_mantissa__h1022 =
	     { IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_compu_ETC___d54[5:0],
	       1'b0 } ;
  assign final_mantissa__h1051 =
	     { IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_compu_ETC___d54[4:0],
	       2'b0 } ;
  assign final_mantissa__h1080 =
	     { IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_compu_ETC___d54[3:0],
	       3'b0 } ;
  assign final_mantissa__h1082 =
	     { IF_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_compu_ETC___d54[2:0],
	       4'b0 } ;
  assign larger_exp__h806 =
	     IF_weight_reg_BITS_14_TO_7_EQ_0_OR_compute_act_ETC___d26 ?
	       compute_psum_in[14:7] :
	       a_exp__h473 ;
  assign larger_sign__h805 =
	     IF_weight_reg_BITS_14_TO_7_EQ_0_OR_compute_act_ETC___d26 ?
	       compute_psum_in[15] :
	       a_sign__h472 ;
  assign man_result__h871 =
	     _1_CONCAT_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_ETC___d42 -
	     { 1'd0, shifted_smaller__h461 } ;
  assign man_result__h946 =
	     _1_CONCAT_IF_IF_weight_reg_BITS_14_TO_7_EQ_0_OR_ETC___d42 +
	     { 1'd0, shifted_smaller__h461 } ;
  assign raw_exp__h506 = exp_sum__h505 - 9'd127 ;
  assign result_exp__h580 =
	     _0_CONCAT_weight_reg_BITS_14_TO_7_PLUS_0_CONCAT_ETC___d11 ?
	       _theResult___fst__h719 :
	       final_exp__h643 ;
  assign shift_amount__h460 =
	     (exp_diff__h459 <= 8'd8) ? exp_diff__h459 : 8'd8 ;
  assign shifted_smaller__h461 = smaller_man__h458 >> shift_amount__h460 ;
  assign smaller_exp__h866 =
	     IF_weight_reg_BITS_14_TO_7_EQ_0_OR_compute_act_ETC___d26 ?
	       a_exp__h473 :
	       compute_psum_in[14:7] ;
  assign smaller_man__h458 =
	     { 1'b1,
	       IF_weight_reg_BITS_14_TO_7_EQ_0_OR_compute_act_ETC___d26 ?
		 a_mantissa__h474 :
		 compute_psum_in[6:0] } ;
  assign smaller_sign__h865 =
	     IF_weight_reg_BITS_14_TO_7_EQ_0_OR_compute_act_ETC___d26 ?
	       a_sign__h472 :
	       compute_psum_in[15] ;
  assign x__h725 = raw_exp__h506 + 9'd1 ;

  // handling of inlined registers

  always@(posedge CLK)
  begin
    if (RST_N == `BSV_RESET_VALUE)
      begin
        activation_out_reg <= `BSV_ASSIGNMENT_DELAY 16'd0;
	psum_out_reg <= `BSV_ASSIGNMENT_DELAY 16'd0;
	weight_reg <= `BSV_ASSIGNMENT_DELAY 16'd0;
      end
    else
      begin
        if (activation_out_reg$EN)
	  activation_out_reg <= `BSV_ASSIGNMENT_DELAY activation_out_reg$D_IN;
	if (psum_out_reg$EN)
	  psum_out_reg <= `BSV_ASSIGNMENT_DELAY psum_out_reg$D_IN;
	if (weight_reg$EN)
	  weight_reg <= `BSV_ASSIGNMENT_DELAY weight_reg$D_IN;
      end
  end

  // synopsys translate_off
  `ifdef BSV_NO_INITIAL_BLOCKS
  `else // not BSV_NO_INITIAL_BLOCKS
  initial
  begin
    activation_out_reg = 16'hAAAA;
    psum_out_reg = 16'hAAAA;
    weight_reg = 16'hAAAA;
  end
  `endif // BSV_NO_INITIAL_BLOCKS
  // synopsys translate_on
endmodule  // mkBF16_PE

